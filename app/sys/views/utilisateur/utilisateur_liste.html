<script>
    function format ( d ) {
        var result;
        var html;
        var innerHtml='';
        html = '<div class="list-group" id="list-group-'+d.id_projet+'">';
        html += '<div class="row items-push-3x text-center">';
        html += '<i class="fa fa-3x fa-cog fa-spin"></i>';
        html += '</div>';
        html += '</div>';
        $.ajax({
            method: 'POST',
            url: 'api/sous_projet_liste.php',
            data:{
                id: d.id_projet
            }
        }).done(function( r ) {
            result = JSON.parse(r);

            innerHtml += '<a class="list-group-item active" href="javascript:void(0)" style="cursor: default">';
            innerHtml += '<span class="badge">'+ result.count+'</span>';
            innerHtml += '<i class="fa fa-fw fa-list push-5-r"></i> Sous projets';
            innerHtml += '</a>';
            jQuery.each(result.data, function(i, val) {
                innerHtml += '<a class="list-group-item" href="?page=sousprojet&idprojet='+ d.id_projet+'">';
                innerHtml += '<i class="fa fa-fw fa-chevron-circle-right push-5-r"></i> '+val.id_sous_projet;
                innerHtml += '</a>';
            });

            $('#list-group-'+d.id_projet).html(innerHtml);
        });

        return html;
    }

    $(document).ready(function() {
        var dt = $('#user_table').DataTable( {
            "language": {
                "url": "assets/js/plugins/datatables/French.json"
            },
            "autoWidth": false,
            "processing": true,
            "serverSide": true,
            "ajax": "api/utilisateur_liste.php",
            "columns": [
                { "data": "nom_utilisateur" },
                { "data": "prenom_utilisateur" },
                { "data": "email_utilisateur" },
                { "data": "lib_profil_utilisateur" }
            ],
            "order": [[1, 'asc']]
        } );

        var btns = ["#add_sub_project",
            "#update_project",
            "#delete_project"];

        $(btns.join(',')).addClass("disabled");

        $('#user_table tbody').on( 'click', 'tr', function (evt) {
            var $table=$(evt.target).closest('table');
            if($table.attr('id').indexOf('user_table') > -1) {
                if ( $(this).hasClass('selected') ) {
                    $(this).removeClass('selected');
                    $('.linked').prop('disabled', true);
                    $(btns.join(',')).addClass("disabled");
                }
                else {
                    dt.$('tr.selected').removeClass('selected');
                    $(this).addClass('selected');
                    $(btns.join(',')).removeClass("disabled");
                    if(dt.row('.selected').data() != undefined)
                    {
                        $('.linked').prop('disabled', false);
                    }
                }
            }
        } );
    } );
</script>
<!-- Table projets -->
<div class="block">
    <div class="block-content">
        <!-- DataTables init on table by adding .js-dataTable-full class, functionality initialized in js/pages/base_tables_datatables.js -->
        <table id="user_table" class="table table-bordered table-striped js-dataTable-full">
            <thead>
            <tr>
                <th>nom</th>
                <th>prénom</th>
                <th>email</th>
                <th>profil</th>
            </tr>
            </thead>
            <tbody>
            </tbody>
            <tfoot>
            <tr>
                <th>nom</th>
                <th>prénom</th>
                <th>email</th>
                <th>profil</th>
            </tr>
            </tfoot>
        </table>
    </div>
</div>
<!-- END Table projets -->