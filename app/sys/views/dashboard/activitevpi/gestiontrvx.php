<div class="block block-themed" id="gestiontrvx_block">
    <div class="block-header bg-primary-light">
        <ul class="block-options">
            <li>
                <button id="activitevpi_gestiontrvx_block_refresh" type="button" data-toggle="block-option" data-action="refresh_toggle" data-action-mode="demo"><i class="si si-refresh"></i></button>
            </li>
        </ul>
        <h3 class="block-title">Gestion des Date de Travaux – Planification OT</h3>
    </div>
    <div class="block-content">
        <!-- Page Content -->
        <div class="content">
            <div class="row">
                <div class="block">
                    <div class="block-header">
                        <h3 class="block-title">Réseau de Transport</h3>
                    </div>
                    <div class="block-content bg-info-light">
                        <table id="gestiontrvx_table1" class="table table-bordered table-striped js-dataTable-full" width="100%">
                            <thead>
                            <tr>
                                <th>nro</th>
                                <th>zone</th>
                                <th>Sous Projet</th>
                                <th>Référence Commande Accès</th>
                                <th>Etat Commande</th>
                                <!--<th>projet</th>-->
                                <th>Date Début Travaux FT</th>
                                <th>Date fin Travaux FT</th>
                                <th>Date Limite Dépôt TFX</th>
                                <th>OT</th>
                                <th>Date Début OT Natif</th>
                                <th>Date Fin OT Natif</th>
                            </tr>
                            </thead>
                            <tbody>
                            </tbody>
                            <tfoot>
                            <tr>
                                <th>nro</th>
                                <th>zone</th>
                                <th>Sous Projet</th>
                                <th>Référence Commande Accès</th>
                                <th>Etat Commande</th>
                                <!--<th>projet</th>-->
                                <th>Date Début Travaux FT</th>
                                <th>Date fin Travaux FT</th>
                                <th>Date Limite Dépôt TFX</th>
                                <th>OT</th>
                                <th>Date Début OT Natif</th>
                                <th>Date Fin OT Natif</th>
                            </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="block">
                    <div class="block-header">
                        <h3 class="block-title">Réseau de Distribution</h3>
                    </div>
                    <div class="block-content bg-info-light">
                        <table id="gestiontrvx_table2" class="table table-bordered table-striped js-dataTable-full" width="100%">
                            <thead>
                            <tr>
                                <th>nro</th>
                                <th>zone</th>
                                <th>Sous Projet</th>
                                <th>Référence Commande Accès</th>
                                <th>Etat Commande</th>
                                <!--<th>projet</th>-->
                                <th>Date Début Travaux FT</th>
                                <th>Date fin Travaux FT</th>
                                <th>Date Limite Dépôt TFX</th>
                                <th>OT</th>
                                <th>Date Début OT Natif</th>
                                <th>Date Fin OT Natif</th>
                            </tr>
                            </thead>
                            <tbody>
                            </tbody>
                            <tfoot>
                            <tr>
                                <th>nro</th>
                                <th>zone</th>
                                <th>Sous Projet</th>
                                <th>Référence Commande Accès</th>
                                <th>Etat Commande</th>
                                <!--<th>projet</th>-->
                                <th>Date Début Travaux FT</th>
                                <th>Date fin Travaux FT</th>
                                <th>Date Limite Dépôt TFX</th>
                                <th>OT</th>
                                <th>Date Début OT Natif</th>
                                <th>Date Fin OT Natif</th>
                            </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="block">
                    <div class="block-header">
                        <h3 class="block-title">Chantiers non démarrés</h3>
                    </div>
                    <div class="block-content bg-info-light">
                        <table id="gestiontrvx_table3" class="table table-bordered table-striped js-dataTable-full" width="100%">
                            <thead>
                            <tr>
                                <th>Nom de L’OT</th>
                                <th>Statut de L’OT</th>
                                <th>Code NRO</th>
                                <th>Etape</th>
                                <th>PCI en charge</th>
                                <th>STT</th>
                                <th>Date début de l’OT</th>
                                <th>Date fin de l’OT</th>
                            </tr>
                            </thead>
                            <tbody>
                            </tbody>
                            <tfoot>
                            <tr>
                                <th>Nom de L’OT</th>
                                <th>Statut de L’OT</th>
                                <th>Code NRO</th>
                                <th>Etape</th>
                                <th>PCI en charge</th>
                                <th>STT</th>
                                <th>Date début de l’OT</th>
                                <th>Date fin de l’OT</th>
                            </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="block">
                    <div class="block-header">
                        <h3 class="block-title">Chantiers en cours</h3>
                    </div>
                    <div class="block-content bg-info-light">
                        <table id="gestiontrvx_table4" class="table table-bordered table-striped js-dataTable-full" width="100%">
                            <thead>
                            <tr>
                                <th>Nom de L’OT</th>
                                <th>Statut de L’OT</th>
                                <th>Code NRO</th>
                                <th>Etape</th>
                                <th>PCI en charge</th>
                                <th>STT</th>
                                <th>Date fin de l’OT</th>
                                <th>Date fin de Travaux FT</th>
                            </tr>
                            </thead>
                            <tbody>
                            </tbody>
                            <tfoot>
                            <tr>
                                <th>Nom de L’OT</th>
                                <th>Statut de L’OT</th>
                                <th>Code NRO</th>
                                <th>Etape</th>
                                <th>PCI en charge</th>
                                <th>STT</th>
                                <th>Date fin de l’OT</th>
                                <th>Date fin de Travaux FT</th>
                            </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <!-- END Page Content -->
    </div>
</div>
<script>
    var gestion_travaux_ctr_dt;
    var gestion_travaux_cdi_dt;
    var gestion_travaux_ch1;
    var gestion_travaux_ch2;
    var gestion_travaux_ch3;
    $(function () {
        // Init page plugins & helpers
    });

    $(document).ready(function() {

        console.log('ready');

        gestion_travaux_ctr_dt = $('#gestiontrvx_table1').on('preXhr.dt', function ( e, settings, data ) {
            $('#gestiontrvx_block').addClass('block-opt-refresh');
        }).DataTable( {
            "language": {
                "url": "assets/js/plugins/datatables/French.json"
            },
            "autoWidth": false,
            "processing": true,
            "serverSide": true,
            "ajax": {
                "url": 'api/dashboard/activitevpi/gestion_travaux_ctr_liste.php'
            },
            "columns": [
                { "data": "lib_nro" },
                { "data": "zone" },
                { "data": "id_sous_projet" },
                { "data": "ref_commande_acces" },
                { "data": "lib_go_ft" },
                { "data": "date_debut_travaux_ft" },
                { "data": "date_fin_travaux_ft" },
                { "data": "date_depot_cmd" },
                { "data": "type_ot" },
                { "data": "date_debut" },
                { "data": "date_fin" }
            ],
            "columnDefs": [
                { "targets": [ 0,1 ], "visible": false, "searchable": true },
                {
                    "targets": 2,
                    orderData: [ 0, 1 ],
                    "data": "lib_nro",
                    "render": function ( data, type, full, meta ) {
                        if(type == "display"){
                            return  '<a href="?page=sousprojet&idsousprojet='+full.id_sous_projet+'">'+full.lib_nro + '-' + full.zone+'</a>';
                        }

                        return full.lib_nro + '-' + full.zone;
                    }
                },
            ],
            "order": [[0, 'desc']]
            ,
            "drawCallback": function( settings ) {
                $('#gestiontrvx_block').removeClass('block-opt-refresh');
            }
        } );
        gestion_travaux_cdi_dt = $('#gestiontrvx_table2').on('preXhr.dt', function ( e, settings, data ) {
            $('#gestiontrvx_block').addClass('block-opt-refresh');
        }).DataTable( {
            "language": {
                "url": "assets/js/plugins/datatables/French.json"
            },
            "autoWidth": false,
            "processing": true,
            "serverSide": true,
            "ajax": {
                "url": 'api/dashboard/activitevpi/gestion_travaux_cdi_liste.php'
            },
            "columns": [
                { "data": "lib_nro" },
                { "data": "zone" },
                { "data": "id_sous_projet" },
                { "data": "ref_commande_acces" },
                { "data": "lib_go_ft" },//lib_go_ft
                { "data": "date_debut_travaux_ft" },
                { "data": "date_fin_travaux_ft" },
                { "data": "date_depot_cmd" },
                { "data": "type_ot" },
                { "data": "date_debut" },
                { "data": "date_fin" }
            ],
            "columnDefs": [
                { "targets": [ 0,1 ], "visible": false, "searchable": true },
                {
                    "targets": 2,
                    orderData: [ 0, 1 ],
                    "data": "lib_nro",
                    "render": function ( data, type, full, meta ) {
                        if(type == "display"){
                            return  '<a href="?page=sousprojet&idsousprojet='+full.id_sous_projet+'">'+full.lib_nro + '-' + full.zone+'</a>';
                        }

                        return full.lib_nro + '-' + full.zone;
                    }
                },
            ],
            "order": [[0, 'desc']]
            ,
            "drawCallback": function( settings ) {
                $('#gestiontrvx_block').removeClass('block-opt-refresh');
            }
        } );

        gestion_travaux_ch1 = $('#gestiontrvx_table3').on('preXhr.dt', function ( e, settings, data ) {
            $('#gestiontrvx_block').addClass('block-opt-refresh');
        }).DataTable( {
            "language": {
                "url": "assets/js/plugins/datatables/French.json"
            },
            "autoWidth": false,
            "processing": true,
            "serverSide": true,
            "ajax": {
                "url": 'api/dashboard/activitevpi/gestion_travaux_ch1.php'
            },
            "columns": [
                { "data": "type_ot" },
                { "data": "lib_etat_ot" },
                { "data": "lib_nro" },
                { "data": "lib_type_ordre_travail" },
                { "data": "prenom_utilisateur" },
                { "data": "nom" },
                { "data": "date_debut" },
                { "data": "date_fin" },
            ],
            "columnDefs": [
                {
                    "targets": 4,
                    orderData: [ 4 ],
                    "data": "prenom_utilisateur",
                    "render": function ( data, type, full, meta ) {
                        return  full.prenom_utilisateur + ' ' + full.nom_utilisateur;
                    }
                },
                {
                    "targets": 0,
                    orderData: [ 0 ],
                    "data": "type_ot",
                    "render": function ( data, type, full, meta ) {
                        if(type == "display"){
                            return  '<a href="?page=ot&idsousprojet='+full.id_sous_projet+'&tentree='+full.type_entree+'">'+data+'</a>';
                        }

                        return data;
                    }
                },
            ],
            "order": [[0, 'desc']]
            ,
            "drawCallback": function( settings ) {
                $('#gestiontrvx_block').removeClass('block-opt-refresh');
            }
        } );

        gestion_travaux_ch2 = $('#gestiontrvx_table4').on('preXhr.dt', function ( e, settings, data ) {
            $('#gestiontrvx_block').addClass('block-opt-refresh');
        }).DataTable( {
            "language": {
                "url": "assets/js/plugins/datatables/French.json"
            },
            "autoWidth": false,
            "processing": true,
            "serverSide": true,
            "ajax": {
                "url": 'api/dashboard/activitevpi/gestion_travaux_ch2.php'
            },
            "columns": [
                { "data": "type_ot" },
                { "data": "lib_etat_ot" },
                { "data": "lib_nro" },
                { "data": "lib_type_ordre_travail" },
                { "data": "prenom_utilisateur" },
                { "data": "nom" },
                { "data": "date_fin" },
                { "data": "date_fin_travaux_ft" },
            ],
            "columnDefs": [
                {
                    "targets": 4,
                    orderData: [ 4 ],
                    "data": "prenom_utilisateur",
                    "render": function ( data, type, full, meta ) {
                        return  full.prenom_utilisateur + ' ' + full.nom_utilisateur;
                    }
                },
                {
                    "targets": 0,
                    orderData: [ 0 ],
                    "data": "type_ot",
                    "render": function ( data, type, full, meta ) {
                        if(type == "display"){
                            return  '<a href="?page=ot&idsousprojet='+full.id_sous_projet+'&tentree='+full.type_entree+'">'+data+'</a>';
                        }

                        return data;
                    }
                },
            ],
            "order": [[0, 'desc']]
            ,
            "drawCallback": function( settings ) {
                $('#gestiontrvx_block').removeClass('block-opt-refresh');
            }
        } );

    } );
</script>